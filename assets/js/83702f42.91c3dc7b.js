"use strict";(self.webpackChunkmiddy=self.webpackChunkmiddy||[]).push([[9099],{8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>l});var s=n(6540);const d={},i=s.createContext(d);function t(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:t(e.components),s.createElement(i.Provider,{value:r},e.children)}},8500:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>l,default:()=>c,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"upgrade/5-6","title":"Upgrade 5.x -> 6.x","description":"aka \\"The return of CJS, kinda\\"","source":"@site/docs/upgrade/5-6.md","sourceDirName":"upgrade","slug":"/upgrade/5-6","permalink":"/docs/upgrade/5-6","draft":false,"unlisted":false,"editUrl":"https://github.com/middyjs/middy/tree/main/website/docs/upgrade/5-6.md","tags":[],"version":"current","lastUpdatedAt":1750110598000,"sidebarPosition":1,"frontMatter":{"title":"Upgrade 5.x -> 6.x","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Upgrade","permalink":"/docs/category/upgrade"},"next":{"title":"Upgrade 4.x -> 5.x","permalink":"/docs/upgrade/4-5"}}');var d=n(4848),i=n(8453);const t={title:"Upgrade 5.x -> 6.x",sidebar_position:1},l=void 0,o={},a=[{value:"Notable changes",id:"notable-changes",level:2},{value:"Core",id:"core",level:2},{value:"Util",id:"util",level:2},{value:"Middleware",id:"middleware",level:2},{value:"appconfig",id:"appconfig",level:2},{value:"cloudwatch-metrics",id:"cloudwatch-metrics",level:3},{value:"do-not-wait-for-empty-event-loop",id:"do-not-wait-for-empty-event-loop",level:3},{value:"error-logger",id:"error-logger",level:3},{value:"event-normalizer",id:"event-normalizer",level:3},{value:"http-content-encoding",id:"http-content-encoding",level:3},{value:"http-content-negotiation",id:"http-content-negotiation",level:3},{value:"http-cors",id:"http-cors",level:3},{value:"http-error-handler",id:"http-error-handler",level:3},{value:"http-event-normalizer",id:"http-event-normalizer",level:3},{value:"http-header-normalizer",id:"http-header-normalizer",level:3},{value:"http-json-body-parser",id:"http-json-body-parser",level:3},{value:"http-multipart-body-parser",id:"http-multipart-body-parser",level:3},{value:"http-partial-response",id:"http-partial-response",level:3},{value:"http-response-serializer",id:"http-response-serializer",level:3},{value:"http-router",id:"http-router",level:3},{value:"http-security-headers",id:"http-security-headers",level:3},{value:"http-urlencode-body-parser",id:"http-urlencode-body-parser",level:3},{value:"http-urlencode-path-parser",id:"http-urlencode-path-parser",level:3},{value:"input-output-logger",id:"input-output-logger",level:3},{value:"rds-signer",id:"rds-signer",level:3},{value:"s3-object-response",id:"s3-object-response",level:3},{value:"secrets-manager",id:"secrets-manager",level:3},{value:"service-discovery",id:"service-discovery",level:3},{value:"sqs-partial-batch-failure",id:"sqs-partial-batch-failure",level:3},{value:"ssm",id:"ssm",level:3},{value:"sts",id:"sts",level:3},{value:"validator",id:"validator",level:3},{value:"warmup",id:"warmup",level:3},{value:"ws-json-body-parser",id:"ws-json-body-parser",level:3},{value:"ws-response",id:"ws-response",level:3},{value:"ws-router",id:"ws-router",level:3},{value:"Notes",id:"notes",level:2}];function h(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.p,{children:'aka "The return of CJS, kinda"'}),"\n",(0,d.jsx)(r.p,{children:"Version 6.x of Middy no longer supports Node.js versions 18.x. You are highly encouraged to move to Node.js 22.x."}),"\n",(0,d.jsx)(r.h2,{id:"notable-changes",children:"Notable changes"}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["Support for ",(0,d.jsx)(r.code,{children:"--experimental-require-module"}),". Introduced into nodejs 20.17, this allows for the import of ESM into CJS codebases, making the migration to ESM easier. See blog post from AWS (",(0,d.jsx)(r.a,{href:"https://aws.amazon.com/blogs/compute/node-js-22-runtime-now-available-in-aws-lambda/",children:"https://aws.amazon.com/blogs/compute/node-js-22-runtime-now-available-in-aws-lambda/"}),") on usage."]}),"\n"]}),"\n",(0,d.jsx)(r.h2,{id:"core",children:"Core"}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["Add in mechanise to handle ",(0,d.jsx)(r.code,{children:"undefined"})," early responses. You can now set ",(0,d.jsx)(r.code,{children:"request.earlyResponse"})," and it will respond with an ",(0,d.jsx)(r.code,{children:"undefined"})," response. The existing method will continue to work as expected."]}),"\n"]}),"\n",(0,d.jsx)(r.h2,{id:"util",children:"Util"}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h2,{id:"middleware",children:"Middleware"}),"\n",(0,d.jsx)(r.h2,{id:"appconfig",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/appconfig",children:"appconfig"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"cloudwatch-metrics",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/cloudwatch-metrics",children:"cloudwatch-metrics"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"do-not-wait-for-empty-event-loop",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/do-not-wait-for-empty-event-loop",children:"do-not-wait-for-empty-event-loop"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"error-logger",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/error-logger",children:"error-logger"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"event-normalizer",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/event-normalizer",children:"event-normalizer"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"http-content-encoding",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-content-encoding",children:"http-content-encoding"})}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["Add in ",(0,d.jsx)(r.code,{children:"Vary"})," support (",(0,d.jsx)(r.a,{href:"https://github.com/middyjs/middy/issues/1253",children:"#1253"}),") ",(0,d.jsx)(r.strong,{children:"Breaking Change"})]}),"\n",(0,d.jsxs)(r.li,{children:["Add in support to skip encoding when ",(0,d.jsx)(r.code,{children:"Cache-Control: no-transform"})," is used (",(0,d.jsx)(r.a,{href:"https://github.com/middyjs/middy/issues/1252",children:"#1252"}),") ",(0,d.jsx)(r.strong,{children:"breaking Change"})]}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"http-content-negotiation",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-content-negotiation",children:"http-content-negotiation"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"http-cors",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-cors",children:"http-cors"})}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["The default ",(0,d.jsx)(r.code,{children:"origin"})," is now ",(0,d.jsx)(r.code,{children:"undefined"}),", defaulting to a secure state. ",(0,d.jsx)(r.strong,{children:"Breaking Change"})]}),"\n",(0,d.jsx)(r.li,{children:"Remove options (requestHeaders, requestMethods) to set request headers that are unused by the browser."}),"\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.code,{children:"Vary: origin"})," now applied when more than one possible origin."]}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"http-error-handler",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-error-handler",children:"http-error-handler"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"http-event-normalizer",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-event-normalizer",children:"http-event-normalizer"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"http-header-normalizer",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-header-normalizer",children:"http-header-normalizer"})}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.code,{children:"rawHeaders"})," is no longer attached to ",(0,d.jsx)(r.code,{children:"event"}),". ",(0,d.jsx)(r.strong,{children:"Breaking Change"})]}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"http-json-body-parser",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-json-body-parser",children:"http-json-body-parser"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"http-multipart-body-parser",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-multipart-body-parser",children:"http-multipart-body-parser"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"http-partial-response",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-partial-response",children:"http-partial-response"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"http-response-serializer",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-response-serializer",children:"http-response-serializer"})}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["deprecate use of ",(0,d.jsx)(r.code,{children:"event.requiredContentType"}),". ",(0,d.jsx)(r.strong,{children:"Breaking Change"})]}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"http-router",children:(0,d.jsx)(r.a,{href:"/docs/routers/http-router",children:"http-router"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"http-security-headers",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-security-headers",children:"http-security-headers"})}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["Add in support for ",(0,d.jsx)(r.code,{children:"Content-Security-Policy-Report-Only"})," (",(0,d.jsx)(r.a,{href:"https://github.com/middyjs/middy/issues/1248",children:"#1248"}),")"]}),"\n",(0,d.jsxs)(r.li,{children:["Add in support for ",(0,d.jsx)(r.code,{children:"Reporting-Endpoints"})," (",(0,d.jsx)(r.a,{href:"https://github.com/middyjs/middy/issues/1249",children:"#1249"}),")"]}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"http-urlencode-body-parser",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-urlencode-body-parser",children:"http-urlencode-body-parser"})}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:["replace use of ",(0,d.jsx)(r.code,{children:"qs"})," with ",(0,d.jsx)(r.code,{children:"node:querystring"}),". Complex nested object are no longer supported. ",(0,d.jsx)(r.strong,{children:"Breaking Change"})]}),"\n"]}),"\n",(0,d.jsx)(r.h3,{id:"http-urlencode-path-parser",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/http-urlencode-path-parser",children:"http-urlencode-path-parser"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"input-output-logger",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/input-output-logger",children:"input-output-logger"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"rds-signer",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/rds-signer",children:"rds-signer"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"s3-object-response",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/s3-object-response",children:"s3-object-response"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"secrets-manager",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/secrets-manager",children:"secrets-manager"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"service-discovery",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/service-discovery",children:"service-discovery"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"sqs-partial-batch-failure",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/sqs-partial-batch-failure",children:"sqs-partial-batch-failure"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"ssm",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/ssm",children:"ssm"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"sts",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/sts",children:"sts"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"validator",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/validator",children:"validator"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"warmup",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/warmup",children:"warmup"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"ws-json-body-parser",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/ws-json-body-parser",children:"ws-json-body-parser"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"ws-response",children:(0,d.jsx)(r.a,{href:"/docs/middlewares/ws-response",children:"ws-response"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h3,{id:"ws-router",children:(0,d.jsx)(r.a,{href:"/docs/routers/ws-router",children:"ws-router"})}),"\n",(0,d.jsx)(r.p,{children:"No change"}),"\n",(0,d.jsx)(r.h2,{id:"notes",children:"Notes"}),"\n",(0,d.jsx)(r.p,{children:"None"})]})}function c(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}}}]);