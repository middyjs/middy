"use strict";(self.webpackChunkmiddy=self.webpackChunkmiddy||[]).push([[53],{620:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/images/middy-middleware-engine-eb7bdaefff782d4d36cce8f149f7fa85.png"},5044:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>d,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"intro/how-it-works","title":"How it works","description":"Middy implements the classic onion-like middleware pattern, with some peculiar details.","source":"@site/docs/intro/03-how-it-works.md","sourceDirName":"intro","slug":"/intro/how-it-works","permalink":"/docs/intro/how-it-works","draft":false,"unlisted":false,"editUrl":"https://github.com/middyjs/middy/tree/main/website/docs/intro/03-how-it-works.md","tags":[],"version":"current","lastUpdatedAt":1750110598000,"sidebarPosition":3,"frontMatter":{"title":"How it works","position":3},"sidebar":"tutorialSidebar","previous":{"title":"Getting started","permalink":"/docs/intro/getting-started"},"next":{"title":"Early Response","permalink":"/docs/intro/early-interrupt"}}');var r=i(4848),s=i(8453);const d={title:"How it works",position:3},o=void 0,l={},a=[{value:"Execution order",id:"execution-order",level:2}];function h(e){const t={code:"code",em:"em",h2:"h2",img:"img",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["Middy implements the classic ",(0,r.jsx)(t.em,{children:"onion-like"})," middleware pattern, with some peculiar details."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Middy middleware engine diagram",src:i(620).A+"",width:"664",height:"547"})}),"\n",(0,r.jsx)(t.p,{children:"When you attach a new middleware this will wrap the business logic contained in the handler\nin two separate steps."}),"\n",(0,r.jsxs)(t.p,{children:["When another middleware is attached this will wrap the handler again and it will be wrapped by\nall the previously added middlewares in order, creating multiple layers for interacting with\nthe ",(0,r.jsx)(t.em,{children:"request"})," (event) and the ",(0,r.jsx)(t.em,{children:"response"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["This way the ",(0,r.jsx)(t.em,{children:"request-response cycle"})," flows through all the middlewares, the\nhandler and all the middlewares again, giving the opportunity within every step to\nmodify or enrich the current request, context, or the response."]}),"\n",(0,r.jsx)(t.h2,{id:"execution-order",children:"Execution order"}),"\n",(0,r.jsxs)(t.p,{children:["Middlewares have two phases: ",(0,r.jsx)(t.code,{children:"before"})," and ",(0,r.jsx)(t.code,{children:"after"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"before"})," phase, happens ",(0,r.jsx)(t.em,{children:"before"})," the handler is executed. In this code the\nresponse is not created yet, so you will have access only to the request."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"after"})," phase, happens ",(0,r.jsx)(t.em,{children:"after"})," the handler is executed. In this code you will\nhave access to both the request and the response."]}),"\n",(0,r.jsx)(t.p,{children:"If you have three middlewares attached (as in the image above), this is the expected\norder of execution:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"middleware1"})," (before)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"middleware2"})," (before)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"middleware3"})," (before)"]}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.code,{children:"handler"})}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"middleware3"})," (after)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"middleware2"})," (after)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"middleware1"})," (after)"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Notice that in the ",(0,r.jsx)(t.code,{children:"after"})," phase, middlewares are executed in inverted order,\nthis way the first handler attached is the one with the highest priority as it will\nbe the first able to change the request and last able to modify the response before\nit gets sent to the user."]})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>d,x:()=>o});var n=i(6540);const r={},s=n.createContext(r);function d(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);