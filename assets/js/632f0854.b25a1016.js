"use strict";(globalThis.webpackChunk_middy_website=globalThis.webpackChunk_middy_website||[]).push([[7421],{6439(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"writing-middlewares/timeouts","title":"Handle Timeouts","description":"When a lambda times out, it throws an error that cannot be caught by middy. To work around this, middy maintains an AbortController that can be signalled early to allow time to clean up and log the error properly.","source":"@site/docs/writing-middlewares/05-timeouts.md","sourceDirName":"writing-middlewares","slug":"/writing-middlewares/timeouts","permalink":"/docs/writing-middlewares/timeouts","draft":false,"unlisted":false,"editUrl":"https://github.com/middyjs/middy/tree/main/website/docs/writing-middlewares/05-timeouts.md","tags":[],"version":"current","lastUpdatedAt":1769628436000,"sidebarPosition":5,"frontMatter":{"title":"Handle Timeouts","position":5},"sidebar":"tutorialSidebar","previous":{"title":"Internal Storage","permalink":"/docs/writing-middlewares/internal-storage"},"next":{"title":"More Examples","permalink":"/docs/writing-middlewares/more-examples"}}');var o=n(4848),a=n(8453);const r={title:"Handle Timeouts",position:5},s=void 0,l={},d=[];function c(e){const t={a:"a",code:"code",em:"em",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["When a lambda times out, it throws an error that cannot be caught by middy. To work around this, middy maintains an ",(0,o.jsx)(t.code,{children:"AbortController"})," that can be signalled early to allow time to clean up and log the error properly."]}),"\n",(0,o.jsxs)(t.p,{children:["You can set ",(0,o.jsx)(t.code,{children:"timeoutEarlyInMillis"})," to 0 to disable this functionality. If you want to override during testing, mock the lambda context to set ",(0,o.jsx)(t.code,{children:"getRemainingTimeInMillis"})," to a function that returns a very large value (e.g. ",(0,o.jsx)(t.code,{children:"() => 99999"}),")."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"import middy from '@middy/core'\n\nconst lambdaHandler = (event, context, { signal }) => {\n  signal.onabort = () => {\n    // cancel events\n  }\n  // ...\n}\n\nexport const handler = middy({\n  timeoutEarlyInMillis: 50,\n  timeoutEarlyResponse: () => {\n    return {\n      statusCode: 408\n    }\n  }\n}).handler(lambdaHandler)\n"})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Notes"})}),"\n",(0,o.jsxs)(t.p,{children:["Do not mistake ",(0,o.jsx)(t.code,{children:"timeoutEarlyInMillis"})," for a \u201ctimeout threshold\u201d, as this is not something middy can control.\nThe actual timeout of a Lambda function is controlled by AWS and you can configure it at the infrastructure level (with a hard limit of 15 minutes),\nsee docs ",(0,o.jsx)(t.a,{href:"https://docs.aws.amazon.com/lambda/latest/dg/configuration-timeout.html",children:"https://docs.aws.amazon.com/lambda/latest/dg/configuration-timeout.html"})]}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"timeoutEarlyInMillis"})," gives you a small buffer of time to perform cleanup or logging before Lambda forcibly terminates the function."]}),"\n",(0,o.jsxs)(t.p,{children:["Example: If your Lambda timeout is 10s and you set ",(0,o.jsx)(t.code,{children:"timeoutEarlyInMillis: 1000"}),", middy will abort at ",(0,o.jsx)(t.em,{children:"approximately"})," 9s, leaving about 1s for cleanup."]})]})}function m(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453(e,t,n){n.d(t,{R:()=>r,x:()=>s});var i=n(6540);const o={},a=i.createContext(o);function r(e){const t=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);