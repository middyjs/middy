<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-integrations/lambda-powertools" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Powertools for AWS Lambda | Middy.js</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://middy.js.org/docs/integrations/lambda-powertools"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Powertools for AWS Lambda | Middy.js"><meta data-rh="true" name="description" content="Powertools for AWS is a developer toolkit to implement Serverless best practices and increase developer velocity."><meta data-rh="true" property="og:description" content="Powertools for AWS is a developer toolkit to implement Serverless best practices and increase developer velocity."><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://middy.js.org/docs/integrations/lambda-powertools"><link data-rh="true" rel="alternate" href="https://middy.js.org/docs/integrations/lambda-powertools" hreflang="en"><link data-rh="true" rel="alternate" href="https://middy.js.org/docs/integrations/lambda-powertools" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6b8e1c13.css">
<script src="/assets/js/runtime~main.f282c685.js" defer="defer"></script>
<script src="/assets/js/main.b48fb0d3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/middy-logo-small.svg" alt="Middy Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/middy-logo-small.svg" alt="Middy Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Middy</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/middlewares/intro">Middlewares</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/events/intro">AWS Events</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/middyjs/middy" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/intro-to-middy">Intro to Middy</a><button aria-label="Expand sidebar category &#x27;Intro to Middy&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/middlewares">Middlewares</a><button aria-label="Expand sidebar category &#x27;Middlewares&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/writing-middlewares">Writing Middlewares</a><button aria-label="Expand sidebar category &#x27;Writing Middlewares&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/routers">Routers</a><button aria-label="Expand sidebar category &#x27;Routers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/upgrade">Upgrade</a><button aria-label="Expand sidebar category &#x27;Upgrade&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/aws-event-examples">AWS Event Examples</a><button aria-label="Expand sidebar category &#x27;AWS Event Examples&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/integrations">Integrations</a><button aria-label="Collapse sidebar category &#x27;Integrations&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/intro">Integrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/RDS">AWS Relational Database Service (RDS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/apollo-server">Apollo Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/integrations/lambda-powertools">Powertools for AWS Lambda</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/pino">Pino</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/serverless-framework">Serverless Framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/integrations/serverless-stack">Serverless Stack</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/best-practices">Best Practices</a><button aria-label="Expand sidebar category &#x27;Best Practices&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/integrations"><span itemprop="name">Integrations</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Powertools for AWS Lambda</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Powertools for AWS Lambda</h1></header><p>Powertools for AWS is a developer toolkit to implement Serverless <a href="https://s12d.com/middy-intro" target="_blank" rel="noopener noreferrer">best practices and increase developer velocity</a>.</p>
<p>You can use Powertools for AWS in both TypeScript and JavaScript code bases.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Powertools officially supports <code>@middy/core</code> both v4.x and v5.x.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro">Intro<a href="#intro" class="hash-link" aria-label="Direct link to Intro" title="Direct link to Intro">​</a></h2>
<p>Powertools is a collection of utilities that can be used independently or together to help you build production-ready serverless applications. Currently, Powertools provides the following utilities that are compatible with Middy:</p>
<ul>
<li><a href="https://s12d.com/middy-logger" target="_blank" rel="noopener noreferrer"><strong>Logger</strong></a> - Structured logging made easier with a middleware to capture key fields from the Lambda context, cold starts, and more. Compatible with Amazon CloudWatch, Datadog, and more.</li>
<li><a href="https://s12d.com/middy-tracer" target="_blank" rel="noopener noreferrer"><strong>Tracer</strong></a> - An opinionated wrapper around AWS X-Ray SDK for Node.js with a middleware to automatically capture traces for function invocations, HTTP requests, and AWS SDK calls, and more.</li>
<li><a href="https://s12d.com/middy-metrics" target="_blank" rel="noopener noreferrer"><strong>Metrics</strong></a> - Create Amazon CloudWatch custom metrics asynchronously with a middleware that takes care of capturing cold starts, and flushes metrics to CloudWatch in <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format.html" target="_blank" rel="noopener noreferrer">EMF-formatted</a> batches.</li>
<li><a href="https://s12d.com/middy-idempotency" target="_blank" rel="noopener noreferrer"><strong>Idempotency</strong></a> - Middleware to make your Lambda functions idempotent and prevent duplicate execution based on payload content.</li>
<li><a href="https://s12d.com/middy-parser" target="_blank" rel="noopener noreferrer"><strong>Parser</strong></a> - Data validation and parsing using Zod, a TypeScript-first schema declaration and validation library.</li>
</ul>
<p>Powertools also provides other utilities that can be used independently of Middy:</p>
<ul>
<li><a href="https://s12d.com/middy-batch-processing" target="_blank" rel="noopener noreferrer"><strong>Parameters</strong></a> - Handle partial failures when processing batches of records from Amazon SQS, Amazon Kinesis Data Streams, and Amazon DynamoDB Streams.</li>
<li><a href="https://s12d.com/middy-parameters" target="_blank" rel="noopener noreferrer"><strong>Batch Processing</strong></a> - Handle partial failures when processing batches of records from Amazon SQS, Amazon Kinesis Data Streams, and Amazon DynamoDB Streams.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="logger">Logger<a href="#logger" class="hash-link" aria-label="Direct link to Logger" title="Direct link to Logger">​</a></h2>
<p>Key features:</p>
<ul>
<li>Capturing key fields from the Lambda context, cold starts, and structure logging output as JSON.</li>
<li>Logging Lambda invocation events when instructed (disabled by default).</li>
<li>Printing all the logs only for a percentage of invocations via log sampling (disabled by default).</li>
<li>Appending additional keys to structured logs at any point in time.</li>
<li>Providing a custom log formatter (Bring Your Own Formatter) to output logs in a structure compatible with your organization’s Logging RFC.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install">Install<a href="#install" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install">​</a></h3>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">npm</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Yarn</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">pnpm</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">npm install --save @aws-lambda-powertools/logger</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">yarn add @aws-lambda-powertools/logger</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">pnpm add @aws-lambda-powertools/logger</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="options">Options<a href="#options" class="hash-link" aria-label="Direct link to Options" title="Direct link to Options">​</a></h3>
<p>Class constructor accepts the following options, which are all optional:</p>
<ul>
<li><code>logLevel</code> (string|LogLevel): Log level to use. Defaults to <code>INFO</code>, but you can use any of the following values: <code>SILENT</code>, <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>, <code>CRITICAL</code>.</li>
<li><code>serviceName</code> (string): Service name to use that will be used in all log statements. Defaults to <code>service_undefined</code>.</li>
<li><code>sampleRateValue</code> (number): number between <code>0.0</code> and <code>1</code> to determine the sample rate for debug logging. Defaults to <code>0</code> (no debub logging).</li>
</ul>
<p>Middleware accepts the following options:</p>
<ul>
<li><code>logger</code> (Logger) (required): An instance of the Logger class.</li>
<li><code>option</code> (object) (optional): An object with the following keys:<!-- -->
<ul>
<li><code>logEvent</code> (boolean) (optional): Whether to log the Lambda invocation event. Defaults to <code>false</code>.</li>
<li><code>clearState</code> (boolean) (optional): Whether to clear the logger state after each invocation. Defaults to <code>false</code>.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-usage">Sample usage<a href="#sample-usage" class="hash-link" aria-label="Direct link to Sample usage" title="Direct link to Sample usage">​</a></h3>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports">middy</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@middy/core&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Logger</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-lambda-powertools/logger&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> injectLambdaContext </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-lambda-powertools/logger/middleware&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> logger </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Logger</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"> </span><span class="token literal-property property">serviceName</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;serverlessAirline&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#0e7490">lambdaHandler</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token parameter">_event</span><span class="token parameter punctuation" style="color:#475569">,</span><span class="token parameter"> _context</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  logger</span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">info</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&#x27;This is an INFO log with some context&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token literal-property property">foo</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token literal-property property">bar</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;baz&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">export</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> handler </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">middy</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">lambdaHandler</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token function" style="color:#0e7490">injectLambdaContext</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The above code will output the following log:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">{</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;cold_start&quot;: true,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;function_arn&quot;: &quot;arn:aws:lambda:eu-west-1:123456789012:function:shopping-cart-api-lambda-prod-eu-west-1&quot;,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;function_memory_size&quot;: 128,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;function_request_id&quot;: &quot;c6af9ac6-7b61-11e6-9a41-93e812345678&quot;,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;function_name&quot;: &quot;shopping-cart-api-lambda-prod-eu-west-1&quot;,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;level&quot;: &quot;INFO&quot;,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;message&quot;: &quot;This is an INFO log with some context&quot;,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;foo&quot;: {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    &quot;bar&quot;: &quot;baz&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;service&quot;: &quot;serverlessAirline&quot;,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;timestamp&quot;: &quot;2021-12-12T21:21:08.921Z&quot;,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;xray_trace_id&quot;: &quot;abcdef123456abcdef123456abcdef123456&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, the log entry includes several fields that are automatically captured by the Logger utility, and that can help you better understand the context of the log entry. For example, the <code>cold_start</code> field indicates whether the Lambda function was cold started or not, and the <code>xray_trace_id</code> field contains the AWS X-Ray trace ID for the Lambda invocation. This is useful when you&#x27;re troubleshooting a problem and want to correlate the logs with the traces.</p>
<p>The Logger utility also allows you to append arbitary keys to the log entry at both <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/logger/#appending-persistent-additional-log-keys-and-values" target="_blank" rel="noopener noreferrer">the global level</a>, at the <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/logger/#clearing-all-state" target="_blank" rel="noopener noreferrer">invocation level</a>, and at the <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/logger/#appending-additional-data-to-a-single-log-item" target="_blank" rel="noopener noreferrer">single log level</a>. For example, there might be some keys that you want to include in all log entries, such as the <code>environment</code> key to differentiate between the <code>prod</code> and <code>dev</code> environments, or in other cases you might want to include some keys only for a specific log entry, such as the <code>customer_id</code> key to identify the customer that triggered the Lambda invocation.</p>
<p>Additionally, you can also configure Logger to <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/logger/#log-incoming-event" target="_blank" rel="noopener noreferrer">log the Lambda invocation event</a>, which can be useful when you&#x27;re troubleshooting a problem and want to see the event that triggered the Lambda invocation. Finally, Logger allows you to <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/logger/#custom-log-formatter-bring-your-own-formatter" target="_blank" rel="noopener noreferrer">define a custom log formatter</a> to output logs in a different JSON structure from the default one. This is useful when you want to output logs in a structure that is compatible with your organization&#x27;s requirements.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tracer">Tracer<a href="#tracer" class="hash-link" aria-label="Direct link to Tracer" title="Direct link to Tracer">​</a></h2>
<p>Key features:</p>
<ul>
<li>Auto-capturing cold start and service name as annotations, and responses or full exceptions as metadata.</li>
<li>Automatically tracing HTTP(S) clients and generating segments for each request.</li>
<li>Supporting tracing functions via decorators, middleware, and manual instrumentation.</li>
<li>Supporting tracing AWS SDK v2 and v3 via AWS X-Ray SDK for Node.js.</li>
<li>Auto-disable tracing when not running in the Lambda environment.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-1">Install<a href="#install-1" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install">​</a></h3>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">npm</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Yarn</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">pnpm</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">npm install --save @aws-lambda-powertools/tracer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">yarn add @aws-lambda-powertools/tracer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">pnpm add @aws-lambda-powertools/tracer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="options-1">Options<a href="#options-1" class="hash-link" aria-label="Direct link to Options" title="Direct link to Options">​</a></h3>
<p>Class constructor accepts the following options, which are all optional:</p>
<ul>
<li><code>serviceName</code> (string): Service name to use that will be used in all log statements. Defaults to <code>service_undefined</code>.</li>
<li><code>enabled</code> (boolean): Whether to enable tracing. Defaults to <code>true</code>.</li>
<li><code>captureHTTPsRequests</code> (boolean): Whether to capture outgoing HTTP(S) requests as segment metadata. Defaults to <code>true</code>.</li>
</ul>
<p>Middleware accepts the following options:</p>
<ul>
<li><code>tracer</code> (Tracer) (required): An instance of the Tracer class.</li>
<li><code>option</code> (object) (optional): An object with the following keys:<!-- -->
<ul>
<li><code>captureResponse</code> (boolean) (optional): Whether to capture the Lambda invocation result as segment metadata. Defaults to <code>true</code>.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-usage-1">Sample usage<a href="#sample-usage-1" class="hash-link" aria-label="Direct link to Sample usage" title="Direct link to Sample usage">​</a></h3>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports">middy</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@middy/core&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Tracer</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-lambda-powertools/tracer&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> captureLambdaHandler </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-lambda-powertools/tracer/middleware&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">SecretsManagerClient</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-sdk/client-secrets-manager&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> tracer </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Tracer</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token literal-property property">serviceName</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;serverlessAirline&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> client </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> tracer</span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">captureAWSv3Client</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">SecretsManagerClient</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">{</span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#0e7490">lambdaHandler</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token parameter">_event</span><span class="token parameter punctuation" style="color:#475569">,</span><span class="token parameter"> _context</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  tracer</span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">putAnnotation</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&#x27;successfulBooking&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">export</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> handler </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">middy</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">lambdaHandler</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token function" style="color:#0e7490">captureLambdaHandler</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">tracer</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The above code instructs the Tracer utility to create a custom segment named <code>## index.handler</code> and to add an annotation to it with the key <code>successfulBooking</code> and the value <code>true</code>. The segment name is automatically generated based on the handler name, and the <code>##</code> prefix is used to indicate that this is a custom segment. The Tracer utility also automatically captures the cold start and service name as annotations, and the Lambda invocation result or any error thrown <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/tracer/#annotations-metadata" target="_blank" rel="noopener noreferrer">as metadata</a>. The segment data will be automatically sent to AWS X-Ray when the Lambda function completes its execution.</p>
<p>Tracer also automatically <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/tracer/#tracing-http-requests" target="_blank" rel="noopener noreferrer">captures and traces any outgoing HTTP(S) requests</a> made by the Lambda function. For example, if your function makes a request to a custom API, the Tracer utility will automatically create a segment for that request which will appear in your trace data and service map. Additionally, it will also <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/tracer/#patching-aws-sdk-clients" target="_blank" rel="noopener noreferrer">capture any AWS SDK calls</a> made by the function, and do the same for them.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="metrics">Metrics<a href="#metrics" class="hash-link" aria-label="Direct link to Metrics" title="Direct link to Metrics">​</a></h2>
<p>Key features:</p>
<ul>
<li>Aggregating up to 100 metrics using a single <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format.html" target="_blank" rel="noopener noreferrer">CloudWatch EMF</a> object.</li>
<li>Validating your metrics against common metric definitions mistakes (for example, metric unit, values, max dimensions, max metrics).</li>
<li>Metrics are created asynchronously by the CloudWatch service. You do not need any custom stacks, and there is no impact to Lambda function latency.</li>
<li>Creating a one-off metric with different dimensions.</li>
</ul>
<p>If you&#x27;re new to Amazon CloudWatch, there are a few terms like <code>Namespace</code>, <code>Dimensions</code>, <code>Unit</code>, etc, that you must be aware of before you start using the Metrics utility. To learn more about these terms, see the <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/metrics/#terminologies" target="_blank" rel="noopener noreferrer">documentation on PowerTools Metrics</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-2">Install<a href="#install-2" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install">​</a></h3>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">npm</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Yarn</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">pnpm</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">npm install --save @aws-lambda-powertools/metrics</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">yarn add @aws-lambda-powertools/metrics</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">pnpm add @aws-lambda-powertools/metrics</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="options-2">Options<a href="#options-2" class="hash-link" aria-label="Direct link to Options" title="Direct link to Options">​</a></h3>
<p>Class constructor accepts the following options, which are all optional:</p>
<ul>
<li><code>serviceName</code> (string): Service name to use that will be used in all log statements. Defaults to <code>service_undefined</code>.</li>
<li><code>defaultNamespace</code> (string): Default namespace to use for all metrics. Defaults to <code>default_namespace</code>.</li>
</ul>
<p>Middleware accepts the following options:</p>
<ul>
<li><code>metrics</code> (Metric) (required): An instance of the Metrics class.</li>
<li><code>option</code> (object) (optional): An object with the following keys:<!-- -->
<ul>
<li><code>throwOnEmptyMetrics</code> (boolean) (optional): Whether to throw an error if no metrics were added. Defaults to <code>false</code>.</li>
<li><code>captureColdStartMetric</code> (boolean) (optional): Whether to capture the cold start metric. Defaults to <code>true</code>.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-usage-2">Sample usage<a href="#sample-usage-2" class="hash-link" aria-label="Direct link to Sample usage" title="Direct link to Sample usage">​</a></h3>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports">middy</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@middy/core&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Metrics</span><span class="token imports punctuation" style="color:#475569">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">MetricUnit</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-lambda-powertools/metrics&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> logMetrics </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-lambda-powertools/metrics/middleware&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> metrics </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Metrics</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token literal-property property">namespace</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;serverlessAirline&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token literal-property property">serviceName</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;orders&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> lambdaHandler </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">_event</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> unknown</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token literal-property property">_context</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> unknown</span><span class="token punctuation" style="color:#475569">)</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:#0ea5e9">Promise</span><span class="token operator" style="color:#475569">&lt;</span><span class="token keyword" style="color:#0c4a6e">void</span><span class="token operator" style="color:#475569">&gt;</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  metrics</span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">addMetric</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&#x27;successfulBooking&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token maybe-class-name">MetricUnits</span><span class="token punctuation" style="color:#475569">.</span><span class="token property-access maybe-class-name">Count</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">1</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">export</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> handler </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">middy</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">lambdaHandler</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token function" style="color:#0e7490">logMetrics</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">metrics</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The above code will output a CloudWatch EMF object similar to the following:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">{</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;successfulBooking&quot;: 1.0,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  &quot;_aws&quot;: {</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    &quot;Timestamp&quot;: 1592234975665,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    &quot;CloudWatchMetrics&quot;: [{</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      &quot;Namespace&quot;: &quot;successfulBooking&quot;,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      &quot;Dimensions&quot;: [</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        [ &quot;service&quot; ]</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      &quot;Metrics&quot;: [{</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        &quot;Name&quot;: &quot;successfulBooking&quot;,</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        &quot;Unit&quot;: &quot;Count&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      }]</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    }],</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    &quot;service&quot;: &quot;orders&quot;</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This EMF object will be sent to CloudWatch asynchronously by the CloudWatch service. You do not need any custom stacks, and there is no impact to Lambda function latency.</p>
<p>The Metrics utility supports <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/metrics/#adding-high-resolution-metrics" target="_blank" rel="noopener noreferrer">high-resolution metrics</a> as well as <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/metrics/#adding-multi-value-metrics" target="_blank" rel="noopener noreferrer">multi-value metrics</a>. It also allows you to add <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/metrics/#adding-default-dimensions" target="_blank" rel="noopener noreferrer">default dimensions</a> that are used in all the metrics emitted by your application or <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/core/metrics/#single-metric-with-different-dimensions" target="_blank" rel="noopener noreferrer">create a one-off metric</a> with different dimensions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="idempotency">Idempotency<a href="#idempotency" class="hash-link" aria-label="Direct link to Idempotency" title="Direct link to Idempotency">​</a></h2>
<p>Key features:</p>
<ul>
<li>Prevent Lambda handler from executing more than once on the same event payload during a time window</li>
<li>Ensure Lambda handler returns the same result when called with the same payload</li>
<li>Select a subset of the event as the idempotency key using JMESPath expressions</li>
<li>Set a time window in which records with the same payload should be considered duplicates</li>
<li>Expires in-progress executions if the Lambda function times out halfway through</li>
</ul>
<p>The property of idempotency means that an operation does not cause additional side effects if it is called more than once with the same input parameters. Idempotent operations will return the same result when they are called multiple times with the same parameters. This makes idempotent operations safe to retry.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-3">Install<a href="#install-3" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install">​</a></h3>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">npm</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Yarn</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">pnpm</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">npm install --save @aws-lambda-powertools/idempotency @aws-sdk/client-dynamodb @aws-sdk/lib-dynamodb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">yarn add @aws-lambda-powertools/idempotency @aws-sdk/client-dynamodb @aws-sdk/lib-dynamodb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token plain">pnpm add @aws-lambda-powertools/idempotency @aws-sdk/client-dynamodb @aws-sdk/lib-dynamodb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="options-3">Options<a href="#options-3" class="hash-link" aria-label="Direct link to Options" title="Direct link to Options">​</a></h3>
<p>Middleware accepts the following options:</p>
<ul>
<li><code>persistenceStore</code> (<a href="https://docs.powertools.aws.dev/lambda/typescript/latest/api/classes/_aws_lambda_powertools_idempotency.persistence.BasePersistenceLayer.html" target="_blank" rel="noopener noreferrer"><code>BasePersistenceLayer</code></a>): Class used to interact with a <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/idempotency/#persistence-layers" target="_blank" rel="noopener noreferrer">persistence store</a>.</li>
<li><code>config</code> (<a href="https://docs.powertools.aws.dev/lambda/typescript/latest/api/classes/_aws_lambda_powertools_idempotency.index.IdempotencyConfig.html" target="_blank" rel="noopener noreferrer"><code>IdempotencyConfig</code></a>) (optional): Configuration object to customize the <a href="https://docs.powertools.aws.dev/lambda/typescript/latest/utilities/idempotency/#customizing-the-default-behavior" target="_blank" rel="noopener noreferrer">default behavior</a> of the idempotency feature.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-usage-3">Sample usage<a href="#sample-usage-3" class="hash-link" aria-label="Direct link to Sample usage" title="Direct link to Sample usage">​</a></h3>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports">middy</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@middy/core&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> randomUUID </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;node:crypto&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> makeHandlerIdempotent </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-lambda-powertools/idempotency/middleware&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">DynamoDBPersistenceLayer</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-lambda-powertools/idempotency/dynamodb&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> persistenceStore </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">DynamoDBPersistenceLayer</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token literal-property property">tableName</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;idempotencyTableName&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#0e7490">createSubscriptionPayment</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token parameter">event</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token comment" style="color:#6A9955">// ... create payment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token literal-property property">id</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">randomUUID</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token literal-property property">productId</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> event</span><span class="token punctuation" style="color:#475569">.</span><span class="token property-access">productId</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword module" style="color:#0c4a6e">export</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> handler </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">middy</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token parameter">event</span><span class="token parameter punctuation" style="color:#475569">,</span><span class="token parameter"> _context</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#0c4a6e">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> payment </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#0c4a6e">await</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">createSubscriptionPayment</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token literal-property property">paymentId</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> payment</span><span class="token punctuation" style="color:#475569">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token literal-property property">message</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;success&#x27;</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">        </span><span class="token literal-property property">statusCode</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token number" style="color:#B5CEA8">200</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#0c4a6e">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#0c4a6e">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">new</span><span class="token plain"> </span><span class="token class-name" style="color:#0ea5e9">Error</span><span class="token punctuation" style="color:#475569">(</span><span class="token string" style="color:#64748b">&#x27;Error creating payment&#x27;</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token function" style="color:#0e7490">makeHandlerIdempotent</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    persistenceStore</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-multiple-utilities">Using multiple utilities<a href="#using-multiple-utilities" class="hash-link" aria-label="Direct link to Using multiple utilities" title="Direct link to Using multiple utilities">​</a></h3>
<p>You can use multiple Powertools utilities in your Lambda function by chaining the respective middlewares together. When doing so the Powertools team recommends that you place the Tracer middleware at the top of the middleware chain, followed by the Logger and any other middlewares.</p>
<p>This is because the Tracer middleware will create a new segment for each Lambda invocation, and the Logger might want to log the event that triggered the Lambda invocation. With this placement you will be able to have a segment that closely matches the actual duration of your Lambda function, and you will be able to see the event that triggered the function invocation before it&#x27;s potentially modified by other middlewares.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword module" style="color:#0c4a6e">export</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> handler </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">middy</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"> </span><span class="token comment" style="color:#6A9955">/* ... */</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token function" style="color:#0e7490">captureLambdaHandler</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">tracer</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token function" style="color:#0e7490">injectLambdaContext</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"> </span><span class="token literal-property property">logEvent</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token function" style="color:#0e7490">logMetrics</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">metrics</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"> </span><span class="token literal-property property">captureColdStartMetric</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cleaning-up-on-early-returns">Cleaning up on early returns<a href="#cleaning-up-on-early-returns" class="hash-link" aria-label="Direct link to Cleaning up on early returns" title="Direct link to Cleaning up on early returns">​</a></h3>
<p>As discussed in the <a href="/docs/intro/early-interrupt">early return section</a>, some middlewares might need to stop the whole execution flow and return a response immediately. In this case, if you are writing your own middleware that will work with the Powertools utilities, you must make sure to clean up the utilities before returning.</p>
<p>For example, if you are using the Tracer utility, you must make sure to call the <code>close</code> method so that the Tracer can properly close the current segment and send it to X-Ray. Likewise, if you are using the Metrics utility, it&#x27;s a good practice to call the <code>clearMetrics</code> method so that the Metrics utility can emit the metrics that were stored in the buffer and avoid you losing any data.</p>
<p>Following the example described in the linked section, you can clean up all the utilities by doing the following:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#0f172a;--prism-background-color:#f1f5f9"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#0f172a;background-color:#f1f5f9"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#0f172a"><span class="token keyword module" style="color:#0c4a6e">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#475569">{</span><span class="token imports"> cleanupMiddlewares </span><span class="token imports punctuation" style="color:#475569">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#0c4a6e">from</span><span class="token plain"> </span><span class="token string" style="color:#64748b">&#x27;@aws-lambda-powertools/commons&#x27;</span><span class="token punctuation" style="color:#475569">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">// some function that calculates the cache id based on the current event</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#0e7490">calculateCacheId</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token parameter">event</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token comment" style="color:#6A9955">/* ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> storage </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">// middleware</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#0e7490">cacheMiddleware</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token parameter">options</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">let</span><span class="token plain"> cacheKey</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#0e7490">cacheMiddlewareBefore</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token parameter">request</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    cacheKey </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">calculateCacheId</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">request</span><span class="token punctuation" style="color:#475569">.</span><span class="token property-access">event</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#0c4a6e">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#475569">.</span><span class="token property-access">storage</span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">hasOwnProperty</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">cacheKey</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token comment" style="color:#6A9955">// clean up the Powertools utilities before returning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token function" style="color:#0e7490">cleanupMiddlewares</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token comment" style="color:#6A9955">// exits early and returns the value from the cache if it&#x27;s already there</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#0c4a6e">return</span><span class="token plain"> options</span><span class="token punctuation" style="color:#475569">.</span><span class="token property-access">storage</span><span class="token punctuation" style="color:#475569">[</span><span class="token plain">cacheKey</span><span class="token punctuation" style="color:#475569">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#0e7490">cacheMiddlewareAfter</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0c4a6e">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">(</span><span class="token parameter">request</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token comment" style="color:#6A9955">// stores the calculated response in the cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    options</span><span class="token punctuation" style="color:#475569">.</span><span class="token property-access">storage</span><span class="token punctuation" style="color:#475569">[</span><span class="token plain">cacheKey</span><span class="token punctuation" style="color:#475569">]</span><span class="token plain"> </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#475569">.</span><span class="token property-access">response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#0c4a6e">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token literal-property property">before</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> cacheMiddlewareBefore</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    </span><span class="token literal-property property">after</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> cacheMiddlewareAfter</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token comment" style="color:#6A9955">// sample usage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token keyword" style="color:#0c4a6e">const</span><span class="token plain"> handler </span><span class="token operator" style="color:#475569">=</span><span class="token plain"> </span><span class="token function" style="color:#0e7490">middy</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">(</span><span class="token parameter">event</span><span class="token parameter punctuation" style="color:#475569">,</span><span class="token parameter"> context</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#475569">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token comment" style="color:#6A9955">/* ... */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token function" style="color:#0e7490">captureLambdaHandler</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">tracer</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token function" style="color:#0e7490">injectLambdaContext</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">logger</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"> </span><span class="token literal-property property">logEvent</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token function" style="color:#0e7490">logMetrics</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain">metrics</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"> </span><span class="token literal-property property">captureColdStartMetric</span><span class="token operator" style="color:#475569">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">.</span><span class="token method function property-access" style="color:#0e7490">use</span><span class="token punctuation" style="color:#475569">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token function" style="color:#0e7490">cacheMiddleware</span><span class="token punctuation" style="color:#475569">(</span><span class="token punctuation" style="color:#475569">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    calculateCacheId</span><span class="token punctuation" style="color:#475569">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">    storage</span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain">  </span><span class="token punctuation" style="color:#475569">}</span><span class="token punctuation" style="color:#475569">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#0f172a"><span class="token plain"></span><span class="token punctuation" style="color:#475569">)</span><span class="token punctuation" style="color:#475569">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/middyjs/middy/tree/main/website/docs/integrations/lambda-powertools.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-08-11T14:17:32.000Z">Aug 11, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/integrations/apollo-server"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Apollo Server</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/integrations/pino"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pino</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intro" class="table-of-contents__link toc-highlight">Intro</a></li><li><a href="#logger" class="table-of-contents__link toc-highlight">Logger</a><ul><li><a href="#install" class="table-of-contents__link toc-highlight">Install</a></li><li><a href="#options" class="table-of-contents__link toc-highlight">Options</a></li><li><a href="#sample-usage" class="table-of-contents__link toc-highlight">Sample usage</a></li></ul></li><li><a href="#tracer" class="table-of-contents__link toc-highlight">Tracer</a><ul><li><a href="#install-1" class="table-of-contents__link toc-highlight">Install</a></li><li><a href="#options-1" class="table-of-contents__link toc-highlight">Options</a></li><li><a href="#sample-usage-1" class="table-of-contents__link toc-highlight">Sample usage</a></li></ul></li><li><a href="#metrics" class="table-of-contents__link toc-highlight">Metrics</a><ul><li><a href="#install-2" class="table-of-contents__link toc-highlight">Install</a></li><li><a href="#options-2" class="table-of-contents__link toc-highlight">Options</a></li><li><a href="#sample-usage-2" class="table-of-contents__link toc-highlight">Sample usage</a></li></ul></li><li><a href="#idempotency" class="table-of-contents__link toc-highlight">Idempotency</a><ul><li><a href="#install-3" class="table-of-contents__link toc-highlight">Install</a></li><li><a href="#options-3" class="table-of-contents__link toc-highlight">Options</a></li><li><a href="#sample-usage-3" class="table-of-contents__link toc-highlight">Sample usage</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best practices</a><ul><li><a href="#using-multiple-utilities" class="table-of-contents__link toc-highlight">Using multiple utilities</a></li><li><a href="#cleaning-up-on-early-returns" class="table-of-contents__link toc-highlight">Cleaning up on early returns</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/middlewares">Middlewares</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/events/intro">AWS Events</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community &amp; support</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/middyjs/middy" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/middy?sort=Newest&amp;uqlId=35052" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitter.im/middyjs/Lobby" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.npmjs.com/package/@middy/core" target="_blank" rel="noopener noreferrer" class="footer__link-item">npm<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Middy - Built with Docusaurus. - Icons by feathericons.com</div></div></div></footer></div>
</body>
</html>